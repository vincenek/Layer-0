<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Layer 0 Decision Mapper</title>
<meta name="theme-color" content="#000000">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<!-- Icons (Base64): -->
<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAEvElEQVR4nO3Y0ZHbOBAEUPpCUv4xKCXfz6lOVkleUgSIAfq9ALbE">
<link rel="icon" type="image/png" sizes="64x64" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABWklEQVR4nO2bTbLDIAyD6TtS7n+GXKlvLVEZYLgOHeWDnSmpZGQpfOVRrKhJsGILcPS/c+BmLgAkGiQR7HbSKkZ1wGhgAuI0OEDGISINgFpYcYUREIGJkZ2yrv0XUTsaQeJbdqKdK+xq2Vi1uQjL9stHW6zvpHwvrFUwPYggvAyFbX/S5raDRhb2JSz42Q49do5IdrsBINyt+MBZoq4Eivd8yF6uLc1voEUhDV7u85XqQn45YWZuAQ61rOwXWPrUe74mH117nud96FMygScDQd9kCtn2nEhjicUpFMxVwVbQghGuYLqgQb0IvtYW0IO6rVG0h5vWCkVWOOaGsaLpZW8XVWQLg4yYQaRMGLx6txVu4+Vy2ID1sr/zH9d6TXU8gVCDOct61Q0+R5o24E6koUdZOgA8JYuQBqLUe3+l6N8+xA2nJqU9GeHa0J7LbSa2sFfblAUqZuh3YnfKhVAm+gkwAW5DyWUQDi+i1/rIQ6v0KJmwMcCldVKV6kVcEQ3QZtwip4CXcSND6n/rFO8/G9SfuVAB79ekbNeY+fMAAAAASUVORK5CYII=">
<!-- Inline web manifest (data URI) -->
<link rel="manifest" href='data:application/manifest+json,{"name":"Layer0 Decision Mapper","short_name":"Layer0","description":"A decision mapping PWA","icons":[{"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAEvElEQVR4nO3Y0ZHbOBAEUPpCUv4xKCXfz6lOVkleUgSIAfq9ALbE","type":"image/png","sizes":"192x192"},{"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAPOUlEQVR4nO3cYXYbyQ2FUU6W5P2vwVua","type":"image/png","sizes":"512x512"}],"start_url":".","display":"standalone","theme_color":"#000000","background_color":"#000000"}'>
<style>
  body { background: #000; color: #fff; font-family: sans-serif; padding: 1em; }
  h1 { margin-top: 0; }
  label { display: block; margin: 0.5em 0; }
  input { background: #222; color: #fff; border: 1px solid #555; padding: 5px; width: 100%; box-sizing: border-box; }
  button { background: #333; color: #fff; border: 1px solid #555; padding: 5px 10px; margin: 0.2em 0.2em 0.2em 0; }
  button:hover { background: #444; }
  ul { list-style: none; margin-left: 0.5em; padding-left: 1em; border-left: 1px solid #555; }
  li { margin: 0.2em 0; }
  #tree { margin-top: 1em; }
  #path { margin-top: 1em; font-weight: bold; }
</style>
</head>
<body>
<h1>Layer 0 Decision Mapper</h1>
<div>
  <label>Decision: <input id="decision"></label>
  <button id="decision-btn">Next</button>
</div>
<div id="why1section" style="display:none;">
  <label>Why #1: <input id="why1"></label>
  <button id="why1-btn">Next</button>
</div>
<div id="why2section" style="display:none;">
  <label>Why #2: <input id="why2"></label>
  <button id="why2-btn">Next</button>
</div>
<div id="why3section" style="display:none;">
  <label>Why #3: <input id="why3"></label>
  <button id="why3-btn">Done</button>
</div>
<div id="controls" style="display:none; margin-top:1em;">
  <button id="generate">Show Path</button>
</div>
<div id="tree"></div>
<div id="path"></div>
<div id="saveload" style="display:none; margin-top:1em;">
  <button id="save">Save Session</button>
  <button id="load">Load Session</button>
  <button id="export">Export JSON</button>
</div>
<script>
(function() {
  // Simple XOR-based encryption/decryption
  function encrypt(text, password) {
    let enc = '';
    for (let i = 0; i < text.length; i++) {
      enc += String.fromCharCode(text.charCodeAt(i) ^ password.charCodeAt(i % password.length));
    }
    return btoa(enc);
  }
  function decrypt(data, password) {
    let str = atob(data);
    let dec = '';
    for (let i = 0; i < str.length; i++) {
      dec += String.fromCharCode(str.charCodeAt(i) ^ password.charCodeAt(i % password.length));
    }
    return dec;
  }
  // Show next section functions
  document.getElementById('decision-btn').onclick = () => {
    const val = document.getElementById('decision').value.trim();
    if (!val) return;
    document.getElementById('why1section').style.display = 'block';
  };
  document.getElementById('why1-btn').onclick = () => {
    const val = document.getElementById('why1').value.trim();
    if (!val) return;
    document.getElementById('why2section').style.display = 'block';
  };
  document.getElementById('why2-btn').onclick = () => {
    const val = document.getElementById('why2').value.trim();
    if (!val) return;
    document.getElementById('why3section').style.display = 'block';
  };
  document.getElementById('why3-btn').onclick = () => {
    const val = document.getElementById('why3').value.trim();
    if (!val) return;
    document.getElementById('controls').style.display = 'block';
    document.getElementById('saveload').style.display = 'block';
  };
  // Display the thought chain and path
  document.getElementById('generate').onclick = () => {
    const decision = document.getElementById('decision').value.trim();
    const why1 = document.getElementById('why1').value.trim();
    const why2 = document.getElementById('why2').value.trim();
    const why3 = document.getElementById('why3').value.trim();
    const treeHTML = `<ul><li>${decision}<ul><li>${why1}<ul><li>${why2}<ul><li>${why3}</li></ul></li></ul></li></ul></li></ul>`;
    document.getElementById('tree').innerHTML = treeHTML;
    document.getElementById('path').textContent = 'Cognito Path: ' + decision + ' → ' + why1 + ' → ' + why2 + ' → ' + why3;
  };
  // Save session to localStorage (with optional password encryption)
  document.getElementById('save').onclick = () => {
    const data = {
      decision: document.getElementById('decision').value.trim(),
      why1: document.getElementById('why1').value.trim(),
      why2: document.getElementById('why2').value.trim(),
      why3: document.getElementById('why3').value.trim()
    };
    const json = JSON.stringify(data);
    const pw = prompt('Set a password for this session (leave blank for no encryption):');
    let record;
    if (pw) {
      const enc = encrypt(json, pw);
      record = {content: enc, encrypted: true};
    } else {
      record = {content: json, encrypted: false};
    }
    localStorage.setItem('layer0', JSON.stringify(record));
    alert('Session saved locally.');
  };
  // Load session from localStorage
  document.getElementById('load').onclick = () => {
    const rec = localStorage.getItem('layer0');
    if (!rec) { alert('No saved session found.'); return; }
    let record = JSON.parse(rec);
    let json;
    if (record.encrypted) {
      const pw = prompt('Enter password to decrypt data:');
      if (!pw) return;
      try {
        json = decrypt(record.content, pw);
      } catch(e) {
        alert('Incorrect password or corrupt data.');
        return;
      }
    } else {
      json = record.content;
    }
    try {
      const data = JSON.parse(json);
      document.getElementById('decision').value = data.decision;
      document.getElementById('why1').value = data.why1;
      document.getElementById('why2').value = data.why2;
      document.getElementById('why3').value = data.why3;
      // reveal all fields
      document.getElementById('why1section').style.display = 'block';
      document.getElementById('why2section').style.display = 'block';
      document.getElementById('why3section').style.display = 'block';
      document.getElementById('controls').style.display = 'block';
      document.getElementById('saveload').style.display = 'block';
      document.getElementById('generate').click();
    } catch(e) {
      alert('Failed to load session.');
    }
  };
  // Export current data as JSON file
  document.getElementById('export').onclick = () => {
    const data = {
      decision: document.getElementById('decision').value.trim(),
      why1: document.getElementById('why1').value.trim(),
      why2: document.getElementById('why2').value.trim(),
      why3: document.getElementById('why3').value.trim()
    };
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'layer0-session.json';
    a.click();
  };
})();
</script>
</body>
</html>