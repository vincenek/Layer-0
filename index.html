<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Layer 0</title>
  <style>
    /* Dark theme and basic reset */
    body {
      margin: 0;
      background-color: #121212;
      color: #eee;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      width: 100%;
      padding: 20px;
    }
    h1, h2 {
      color: #fff;
      margin-bottom: 20px;
    }
    p {
      margin: 10px 0;
    }
    button {
      background-color: #1e90ff;
      color: #fff;
      border: none;
      padding: 10px 20px;
      margin: 10px 5px 10px 0;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover {
      background-color: #63b3ed;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      background-color: #333;
      color: #fff;
      border: 1px solid #555;
      border-radius: 5px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    input::placeholder, textarea::placeholder {
      color: #999;
    }
    .hidden {
      display: none;
    }
    .fade-in {
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    ul {
      text-align: left;
      margin-left: 20px;
    }
    .session-item {
      background-color: #1a1a1a;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    .session-item strong {
      color: #ddd;
    }
    /* Responsive adjustments */
    @media (max-width: 600px) {
      h1, h2 {
        font-size: 1.5rem;
      }
      button {
        width: 100%;
        margin: 10px 0;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <!-- Welcome Screen -->
  <div id="welcomeScreen">
    <h1>Layer 0</h1>
    <p>Map your decision-making process.</p>
    <button id="beginBtn">Begin Mapping</button>
    <button id="viewPastBtn">View Past Sessions</button>
  </div>

  <!-- Step 1: Decision Input -->
  <div id="step1" class="hidden">
    <h2>Step 1: Your Decision</h2>
    <label for="decisionInput">What recent decision did you make?</label>
    <textarea id="decisionInput" rows="2" placeholder="Enter your decision here..."></textarea>
    <button id="next1">Next</button>
  </div>

  <!-- Step 2: Why 1 -->
  <div id="step2" class="hidden">
    <h2>Step 2: Why?</h2>
    <label for="why1Input">Why did you make this decision?</label>
    <textarea id="why1Input" rows="2" placeholder="Enter your reason..."></textarea>
    <button id="next2">Next</button>
  </div>

  <!-- Step 3: Why 2 -->
  <div id="step3" class="hidden">
    <h2>Step 3: Why Again?</h2>
    <label for="why2Input">Why do you think that reason was your motivation?</label>
    <textarea id="why2Input" rows="2" placeholder="Enter your next reason..."></textarea>
    <button id="next3">Next</button>
  </div>

  <!-- Step 4: Why 3 -->
  <div id="step4" class="hidden">
    <h2>Step 4: Why a Third Time?</h2>
    <label for="why3Input">Why is that reason important to you?</label>
    <textarea id="why3Input" rows="2" placeholder="Enter your final reason..."></textarea>
    <button id="finishBtn">Finish</button>
  </div>

  <!-- Result Screen: Thought Chain and Cognito Path -->
  <div id="resultScreen" class="hidden">
    <h2>Thought Chain</h2>
    <div id="thoughtChain"></div>
    <h2>Cognito Path</h2>
    <div id="cognitoPath"></div>
    <button id="newSessionBtn">Start New Session</button>
    <button id="viewPastBtn2">View Past Sessions</button>
  </div>

  <!-- Past Sessions Screen -->
  <div id="pastScreen" class="hidden">
    <h2>Past Sessions</h2>
    <div id="sessionList"></div>
    <button id="clearHistoryBtn">Clear History</button>
    <button id="backBtn">Back</button>
  </div>
</div>

<script>
  // References to elements
  const welcomeScreen = document.getElementById('welcomeScreen');
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const step3 = document.getElementById('step3');
  const step4 = document.getElementById('step4');
  const resultScreen = document.getElementById('resultScreen');
  const pastScreen = document.getElementById('pastScreen');

  const beginBtn = document.getElementById('beginBtn');
  const viewPastBtn = document.getElementById('viewPastBtn');
  const viewPastBtn2 = document.getElementById('viewPastBtn2');
  const newSessionBtn = document.getElementById('newSessionBtn');
  const backBtn = document.getElementById('backBtn');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');

  const decisionInput = document.getElementById('decisionInput');
  const why1Input = document.getElementById('why1Input');
  const why2Input = document.getElementById('why2Input');
  const why3Input = document.getElementById('why3Input');

  const next1 = document.getElementById('next1');
  const next2 = document.getElementById('next2');
  const next3 = document.getElementById('next3');
  const finishBtn = document.getElementById('finishBtn');

  const thoughtChainDiv = document.getElementById('thoughtChain');
  const cognitoPathDiv = document.getElementById('cognitoPath');
  const sessionList = document.getElementById('sessionList');

  // In-memory storage of current answers
  let answers = [];

  // Utility to show/hide screens with fade-in effect
  function showScreen(screen) {
    [welcomeScreen, step1, step2, step3, step4, resultScreen, pastScreen].forEach(s => {
      s.classList.add('hidden');
    });
    screen.classList.remove('hidden');
    screen.classList.add('fade-in');
  }

  // Event: Begin Mapping
  beginBtn.addEventListener('click', () => {
    answers = []; // reset current answers
    decisionInput.value = '';
    why1Input.value = '';
    why2Input.value = '';
    why3Input.value = '';
    showScreen(step1);
  });

  // Event: View Past Sessions from welcome
  viewPastBtn.addEventListener('click', () => {
    displayPastSessions();
    showScreen(pastScreen);
  });

  // Event: View Past Sessions from result
  viewPastBtn2.addEventListener('click', () => {
    displayPastSessions();
    showScreen(pastScreen);
  });

  // Event: Back to welcome from past
  backBtn.addEventListener('click', () => {
    showScreen(welcomeScreen);
  });

  // Next buttons for each step
  next1.addEventListener('click', () => {
    const decision = decisionInput.value.trim();
    if (!decision) {
      alert('Please enter a decision to continue.');
      return;
    }
    answers[0] = decision;
    showScreen(step2);
  });

  next2.addEventListener('click', () => {
    const why1 = why1Input.value.trim();
    if (!why1) {
      alert('Please enter a reason to continue.');
      return;
    }
    answers[1] = why1;
    showScreen(step3);
  });

  next3.addEventListener('click', () => {
    const why2 = why2Input.value.trim();
    if (!why2) {
      alert('Please enter a reason to continue.');
      return;
    }
    answers[2] = why2;
    showScreen(step4);
  });

  finishBtn.addEventListener('click', () => {
    const why3 = why3Input.value.trim();
    if (!why3) {
      alert('Please enter a reason to finish.');
      return;
    }
    answers[3] = why3;
    showResults();
  });

  // Start new session (go back to welcome)
  newSessionBtn.addEventListener('click', () => {
    showScreen(welcomeScreen);
  });

  // Clear localStorage history
  clearHistoryBtn.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear all history?')) {
      localStorage.removeItem('layer0_sessions');
      displayPastSessions();
    }
  });

  // Display past sessions from localStorage
  function displayPastSessions() {
    sessionList.innerHTML = '';
    const sessions = JSON.parse(localStorage.getItem('layer0_sessions') || '[]');
    if (sessions.length === 0) {
      sessionList.innerHTML = '<p>No past sessions found.</p>';
      return;
    }
    sessions.forEach((session, index) => {
      const item = document.createElement('div');
      item.className = 'session-item';
      const date = new Date(session.timestamp);
      item.innerHTML = `
        <p><strong>Session ${index + 1}:</strong> ${date.toLocaleString()}</p>
        <p><strong>Decision:</strong> ${session.decision}</p>
        <p><strong>Cognito Decision:</strong> ${session.cognitoDecision}</p>
      `;
      // Optionally, could include more summary if desired
      sessionList.appendChild(item);
    });
  }

  // Generate cognitopath suggestions from answers
  function generateCognito(decision, reasons) {
    // Helper to apply replacements
    function applyPatterns(text) {
      let result = text;
      // Handle "can't lose" specifically
      if (/can't lose/i.test(result)) {
        return 'Consider how to manage that risk carefully.';
      }
      // Patterns for word replacements
      const patterns = [
        [/should/gi, 'could'],
        [/\bhave to\b/gi, 'can'],
        [/\bmust\b/gi, 'could'],
        [/\bcannot\b/gi, 'could try to'],
        [/\bcan't\b/gi, 'could try to'],
        [/\bnot sure\b/gi, 'explore and learn about'],
        [/\bnever\b/gi, 'could someday'],
        [/\bafraid of\b/gi, 'consider planning for'],
        [/\bworried about\b/gi, 'focus on addressing the issues of'],
        [/\bfear\b/gi, 'embrace the challenge of'],
        [/\bworry(ed)?\b/gi, 'focus on addressing'],
        [/\bproblem\b/gi, 'opportunity'],
        [/\bimpossible\b/gi, 'possible'],
        [/\bfail(ed)?\b/gi, 'succeed']
      ];
      patterns.forEach(([pattern, repl]) => {
        result = result.replace(pattern, repl);
      });
      return result;
    }

    // Generate new decision phrase
    let newDecision = applyPatterns(decision);
    if (newDecision.toLowerCase().trim() === decision.toLowerCase().trim()) {
      newDecision = 'Consider alternative perspective: ' + decision;
    }
    // Generate new reasons
    const newReasons = reasons.map(ans => {
      let newAns = applyPatterns(ans);
      if (newAns.toLowerCase().trim() === ans.toLowerCase().trim()) {
        newAns = 'Perhaps explore differently: ' + ans;
      }
      return newAns;
    });
    return { newDecision, newReasons };
  }

  // Show thought chain and cognitopath, save session
  function showResults() {
    // Build thought chain list
    let chainHTML = '<ul>';
    chainHTML += `<li><strong>Decision:</strong> ${answers[0]}</li>`;
    chainHTML += `<ul>`;
    chainHTML += `<li><strong>Reason 1:</strong> ${answers[1]}</li>`;
    chainHTML += `<ul>`;
    chainHTML += `<li><strong>Reason 2:</strong> ${answers[2]}</li>`;
    chainHTML += `<ul>`;
    chainHTML += `<li><strong>Reason 3:</strong> ${answers[3]}</li>`;
    chainHTML += `</ul></ul></ul></ul>`;
    thoughtChainDiv.innerHTML = chainHTML;

    // Generate cognitopath suggestions
    const { newDecision, newReasons } = generateCognito(answers[0], [answers[1], answers[2], answers[3]]);
    let cogHTML = '<ul>';
    cogHTML += `<li><strong>Better Decision:</strong> ${newDecision}</li>`;
    cogHTML += `<ul>`;
    cogHTML += `<li><strong>Better Reason 1:</strong> ${newReasons[0]}</li>`;
    cogHTML += `<ul>`;
    cogHTML += `<li><strong>Better Reason 2:</strong> ${newReasons[1]}</li>`;
    cogHTML += `<ul>`;
    cogHTML += `<li><strong>Better Reason 3:</strong> ${newReasons[2]}</li>`;
    cogHTML += `</ul></ul></ul></ul>`;
    cognitoPathDiv.innerHTML = cogHTML;

    // Show result screen
    showScreen(resultScreen);

    // Save session to localStorage
    const sessions = JSON.parse(localStorage.getItem('layer0_sessions') || '[]');
    const sessionData = {
      timestamp: Date.now(),
      decision: answers[0],
      reasons: answers.slice(1),
      cognitive: newReasons,
      cognitoDecision: newDecision
    };
    sessions.push(sessionData);
    localStorage.setItem('layer0_sessions', JSON.stringify(sessions));
  }

  // On load, show welcome screen (and optionally load existing sessions if needed)
  showScreen(welcomeScreen);
</script>
</body>
</html>